\ProvidesPackage{katdoc}
\newcommand{\stylesheetVersion}{1.1.3-DSP}

\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{lastpage}
\usepackage{mathptmx}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{array}
\usepackage{babel}
\usepackage{csquotes}  % Latex recommends this when babel is used
\usepackage{fancyhdr}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{ifthen}
\usepackage{float}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{tablefootnote}
\usepackage{color}
\usepackage{colortbl}

\geometry{nomarginpar,verbose,a4paper,tmargin=32mm,bmargin=27mm,lmargin=21mm,rmargin=19mm,headheight=10mm,headsep=12mm,footskip=12mm}
\setlength{\parskip}{\medskipamount}
\setlength{\parindent}{0pt}
\setlength{\unitlength}{1mm}
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

% Front Cover
\newcommand{\addcontributor}[5]{%
  #1 & #2 & #3 & #4 & #5 & \\
  \hline
}

\newcommand{\addchange}[4]{%
  #1 & #2 & #3 & #4 \\
  \hline
}

\newcommand{\addprogram}[4]{%
  #1 & #2 & #3 \\
  \hline
}

% Abbreviations

\newcommand{\abbrev}[2]{%
  #1 & #2\\
  \hline
}

\newcommand{\listofabbreviations}{%
  \section*{Glossary}

  \begin{tabular}{|p{0.1\textwidth}|p{0.84\textwidth}|}
    \hline
    \abbreviations%
  \end{tabular}
}

% Extract version information from pdftex
\def\extractpdftexversion#1-#2-#3 #4\@nil{#3}%
\def\myversion{\expandafter\extractpdftexversion\pdftexbanner\@nil}%

%% Format: \addprogram{Role}{Package}{Version}
\newcommand{\docSoftware}{%
  \addprogram{\LaTeX processor}{pdf\LaTeX}{\myversion}{}%
}%

\renewcommand{\maketitle}{%
  \begin{titlepage}
    \begin{center}

      % SKA logo
      \begin{figure}
        \begin{center}
          \includegraphics[width=0.66\linewidth]{sarao_logo.png}
        \end{center}
      \end{figure}
      \vspace{4cm}

      \renewcommand{\arraystretch}{1.5}


      % Title
      \huge
      \textbf{\@title}
      \vspace{3cm}

      % Document Information Table
      \Large
      \begin{centering}
        \makebox[0.75\linewidth]{Document number~\dotfill~\docId}\\
        \makebox[0.75\linewidth]{Revision~\dotfill~\docRevision}\\
        \makebox[0.75\linewidth]{Classification~\dotfill~\docClassification}\\
        \makebox[0.75\linewidth]{Prepared by~\dotfill~\theAuthor}\\
        \makebox[0.75\linewidth]{Date~\dotfill~\docDate}\\
      \end{centering}


      % Client Table
      \normalsize
      \begin{table}[b]
        \centering
        \begin{tabularx}{0.8\textwidth}{Xcr}
          \hline
          \textbf{Organisation}        & : & \docClient   \\
          \textbf{Facility}            & : & \docFacility \\
          \textbf{Project}             & : & \docProject  \\
          \textbf{Document Type}       & : & \docType     \\
          \textbf{Function/Discipline} & : & \docFunction \\
          \hline
        \end{tabularx}
      \end{table}
    \end{center}
  \end{titlepage}
  %\stepcounter{page}
}

\newcommand{\makeInfoPage}{%
  \begin{center}
    % lots of padding for signatures
    \renewcommand{\arraystretch}{1.5}

    % Approval Table
    \LARGE
    \textbf{Document Approval}

    \normalsize
    \begin{tabularx}{\textwidth}{|l|l|l|l|X|X|}
      \hline
      \textbf{Function} & \textbf{Name} & \textbf{Designation} & \textbf{Affiliation} & \textbf{Date} & \textbf{Signature} \\
      \hline
      \docApproval%
    \end{tabularx}
    \vspace{0.3cm}

    % Document History
    \LARGE

    \textbf{Document History}

    \renewcommand{\arraystretch}{1.2}
    \normalsize
    \begin{tabular}{|p{0.1\textwidth}|p{0.15\textwidth}|p{0.15\textwidth}|p{0.5\textwidth}|}
      \hline
      \textbf{Revision} & \textbf{Date of Issue} & \textbf{ECN Number} & \textbf{Comments} \\
      \hline
      \docHistory%
    \end{tabular}
    \vspace{0.3cm}


    % Document Software
    \LARGE
    \textbf{Document Software}

    \normalsize
    \begin{tabularx}{\textwidth}{|l|l|X|}
      \hline
      \textbf{Task} & \textbf{Package} & \textbf{Version}   \\
      \hline
      Stylesheet    & katdoc           & \stylesheetVersion \\
      \hline
      \docSoftware%
    \end{tabularx}
    \vspace{0.3cm}

    % Company Details
    \LARGE
    \textbf{Company Details}

    \normalsize
    \newcolumntype{L}{>{\raggedright\arraybackslash}X}
    \begin{tabularx}{\textwidth}{|c|L|L|L|}
      \hline
      Name                                                                                   & SARAO, Cape Town       & SARAO, HartRAO    & SARAO, Karoo Astronomy Reserve \\
      \hline
      \multirow{6}{*}{\begin{tabular}[c]{@{}l@{}}Physical /\\Postal \\ Address\end{tabular}} & Black River Park North & P.O. Box 443,     & Posbus 69,                     \\
                                                                                             & 2 Fir Street,          & Krugersdorp,      & Carnarvon,                     \\
                                                                                             & Observatory,           & 1740,             & 8925,                          \\
                                                                                             & Cape Town,             & South Africa      & South Africa                   \\
                                                                                             & 7925,                  &                   &                                \\
                                                                                             & South Africa           &                   &                                \\
      \hline
      Tel.                                                                                   & +27 21 506 7300        & +27 12 301 3100   & +27 21 506 7300                \\
      \hline
      Fax                                                                                    & +27 21 506 7375        & +27 12 301 3300   & +27 86 538 6836                \\
      \hline
      \small
      Website                                                                                & www.sarao.ac.za        & www.hartrao.ac.za & www.sarao.ac.za                \\
      \hline
    \end{tabularx}
    \vspace{1cm}
    \normalsize

    % reset table cell padding
    \renewcommand{\arraystretch}{1.0}
  \end{center}
}

% General Page Header and Footer
\fancypagestyle{normal}{%
  \fancyhead{} % clear all header fields
  \fancyhead[C]{\docClassification}
  \fancyhead[R]{\docId \\ Revision: \docRevision}

  \fancyfoot{} % clear all footer fields
  \fancyfoot[L]{\docDate}
  \fancyfoot[C]{\docClassification}
  % The * is to make hyperref not link this one.
  \fancyfoot[R]{Page \thepage\ of \pageref*{LastPage}}

  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0.4pt}
}

% The entire beginning part of the document

\newcommand{\makekatdocbeginning}{%
  \pagenumbering{roman}
  \pagestyle{empty}
  \maketitle
  \pagestyle{normal}
  \makeInfoPage%

  \newpage{}
  \setcounter{page}{1} % reset page numbering for the actual content
  \pagenumbering{arabic}

  \tableofcontents{}
  \newpage{}

  \listoffigures

  \listoftables

  \listofabbreviations
  \newpage{}
}
